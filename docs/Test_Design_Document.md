# テスト設計書
[テスト作業中のbranchはコチラ](https://github.com/ms-engineer-bc25-04/sec9_teamB/tree/feature/qa-test)

---

## 1. テスト方針・品質保証範囲

- 目的：システム全体（API・UI・DB）の品質・信頼性・保守性を担保
- 保証範囲：API 機能・UI 操作性・データ整合性・連携動作・セキュリティ

---

## 2. テスト環境・運用

- Docker Compose で全サービス起動
- CI（GitHub Actions）で静的解析・テスト自動化
- テスト DB は PostgreSQL

---

## 3. テスト方針・レイヤー

### （1）テスト観点

| テスト種別 | フロントエンドの主な観点・方針                | バックエンドの主な観点・方針                          |
| ---------- | --------------------------------------------- | ----------------------------------------------------- |
| 静的解析   | ESLint/Prettier で品質・整形ルール統一        | flake8/black で品質・整形ルール統一                   |
| 単体テスト | UI 操作・関数・バリデーション・異常系・境界値 | API・関数・バリデーション・異常系・権限・境界値       |
| 結合テスト | 複数コンポーネント連携・API 通信・モック活用  | API-DB 連携・マイグレーション・複雑データ操作         |
| E2E テスト | 主要ユーザーフロー・画面遷移・ログイン等      | （E2E は主にフロント中心。必要に応じて API 連携確認） |
| CI/CD      | GitHub Actions で自動実行・カバレッジ測定     | GitHub Actions で自動実行・カバレッジ測定             |

---

### （2）ツール

| 区分           | 静的解析         | 単体テスト                         | 結合テスト         | E2E テスト      | CI/CD          |
| -------------- | ---------------- | ---------------------------------- | ------------------ | --------------- | -------------- |
| フロントエンド | ESLint, Prettier | Vitest, React Testing Library, MSW | Vitest, MSW        | Cypress（予定） | GitHub Actions |
| バックエンド   | flake8, black    | pytest, Mock                       | pytest, PostgreSQL | -               | GitHub Actions |

---

## 5. カバレッジ・バグ管理

カバレッジ目標：80%以上／CI で自動測定・未カバー領域は優先的に追加
バグは GitHub Issues/JIRA で管理

---

## 6. 作業チェックリスト

静的解析、単体・結合・E2E テスト、CI/CD・カバレッジ管理の作業内容

### （1） 静的解析

| ステップ | 区分     | ツール名 | チェック内容（目的・作業）                                                                    | 備考（修正・追加ファイル等） |
| -------- | -------- | -------- | --------------------------------------------------------------------------------------------- | ---------------------------- |
| 1.1 ✅   | frontend | ESLint   | プロジェクト全体の JS/TS コードに対して、構文・品質・ルール違反を自動検出できるよう設定・運用 | .eslintrc.js, .eslintignore  |
| 1.2 ✅   | frontend | Prettier | コードの書式（インデント・改行・スペース等）が統一されるように設定し、CI でも自動整形         | .prettierrc, .prettierignore |
| 1.3 ✅   | backend  | flake8   | Python コードの PEP8 準拠や品質違反を自動検出できるよう設定・運用                             | .flake8                      |
| 1.4 ✅   | backend  | black    | Python コードの書式（インデント・スペース等）が統一されるように設定し、CI でも自動整形        | pyproject.toml               |

### （2） 単体テスト

| ステップ | 区分     | ツール名                  | チェック内容（目的・作業）                                                                           | 備考（修正・追加ファイル等） |
| -------- | -------- | ------------------------- | ---------------------------------------------------------------------------------------------------- | ---------------------------- |
| 2.1 ✅   | frontend | Vitest                    | React コンポーネントや関数ごとに、入力・出力・副作用が期待通りかをテストコードで検証                 | tests                        |
| 2.2 ✅   | frontend | React Testing Library     | ユーザー操作（クリック・入力）や画面表示が正しく動作するかをテストコードで検証                       | tests                        |
| 2.3 ✅   | frontend | Mock Service Worker (MSW) | API 通信部分をモック化し、外部 API がなくてもフロント単体テストが安定して実行できるように設定        | MSW 関連ファイル             |
| 2.4 ✅   | backend  | pytest                    | Python 関数や API エンドポイントごとに、入力・出力・副作用が期待通りかをテストコードで検証           | tests                        |
| 2.5 ✅   | backend  | Mock                      | DB や外部 API の依存部分をモック化し、バックエンド単体テストが外部環境に依存せず実行できるように設定 | mocks                        |

### （3） 結合テスト

| ステップ | 区分     | ツール名                  | チェック内容（目的・作業）                                                                            | 備考（修正・追加ファイル等）                     |
| -------- | -------- | ------------------------- | ----------------------------------------------------------------------------------------------------- | ------------------------------------------------ |
| 3.1 ✅   | frontend | Vitest                    | 複数コンポーネントや API 連携部分が、実際のデータや状態で正しく連携できるかを検証                     | tests                                            |
| 3.2 🔼   | frontend | Mock Service Worker (MSW) | API モックを使い、フロントとバックエンドの連携部分の結合テストを安定して実行できるように設定          | MSW 関連ファイル。MSW の不具合でテスト fail 中。 |
| 3.3 ✅   | backend  | pytest                    | バックエンド API と PostgreSQL テスト DB が連携して、データの保存・取得・更新が正しく行われるかを検証 | tests, マイグレーション関連                      |
| 3.4 ✅   | backend  | PostgreSQL（テスト DB）   | 本番に近い DB 環境で、マイグレーションや複雑なデータ操作の結合テストを実施                            | tests, マイグレーション関連                      |

### （4） E2E テスト

| ステップ | 区分     | ツール名        | チェック内容（目的・作業）                                                                  | 備考（修正・追加ファイル等） |
| -------- | -------- | --------------- | ------------------------------------------------------------------------------------------- | ---------------------------- |
| 4.1      | frontend | Cypress（予定） | 実際のブラウザ上で、ユーザー操作（ログイン・画面遷移など）が期待通りに動作するかを検証      | cypress/                     |
| 4.2      | frontend | Cypress（予定） | 主要なユーザーフロー（例：ログイン → 投稿 → 一覧表示など）の E2E テストシナリオを作成・実装 | テストシナリオファイル       |

### （5） CI/CD 実行環境

| ステップ | 区分 | ツール名       | チェック内容（目的・作業）                                                                | 備考（修正・追加ファイル等） |
| -------- | ---- | -------------- | ----------------------------------------------------------------------------------------- | ---------------------------- |
| 5.1 ✅   | 共通 | GitHub Actions | プルリクエストやマージ時に、静的解析・各種テストが自動で実行されるよう CI/CD を設定・運用 | ci.yml                       |

### （6） カバレッジ管理

| ステップ | 区分     | ツール名 | チェック内容（目的・作業）                                      | 備考（修正・追加ファイル等） |
| -------- | -------- | -------- | --------------------------------------------------------------- | ---------------------------- |
| 6.1 ✅   | frontend | Vitest   | ステートメント/分岐カバレッジ 80%以上を目標に定期的に測定       | tests, カバレッジレポート    |
| 6.2 ✅   | backend  | pytest   | バックエンド API のカバレッジを測定し、未カバー領域を抽出・改善 | tests, カバレッジレポート    |

### （7） その他

| ステップ | 区分 | ツール名 | チェック内容（目的・作業）                       | 備考（修正・追加ファイル等） |
| -------- | ---- | -------- | ------------------------------------------------ | ---------------------------- |
| 7.1  ✅    | 共通 | -        | テスト結果・課題・改善点をテスト報告書にまとめる | テスト報告書ファイル         |

## 7. テスト関連ファイル構成

```
.
├─backend
│  ├─app
│  │  ├─api                 # API実装（テスト対象）
│  │  ├─db                  # DB関連（テスト対象）
│  ├─tests                  # バックエンドAPI・DBのテストコード
│  │  ├─static_analysis     # 🔍 静的解析（flake8, black）
│  │  ├─unit                # 🧪 単体テスト（pytest, Mock）
│  │  ├─integration         # 🔗 結合テスト（API-DB連携、マイグレーション）
│  │  ├─e2e                 # 🕹️ E2Eテスト（必要に応じてAPI連携確認）
│  │  ├─coverage            # � カバレッジレポート（pytest-cov等）
│  │  ├─mocks               # 🪆 モック定義
│  └─...                    # その他バックエンド関連
├─frontend
│  ├─src                    # フロント実装（テスト対象）
│  ├─tests                  # フロントエンドのテストコード
│  │  ├─static_analysis     # 🔍 静的解析（ESLint, Prettier）
│  │  ├─unit                # 🧪 単体テスト（Vitest, React Testing Library）
│  │  ├─integration         # 🔗 結合テスト（Vitest, MSW）
│  │  ├─e2e                 # 🕹️ E2Eテスト（Cypress）
│  │  ├─coverage            # � カバレッジレポート（Vitest）
│  │  ├─mocks               # 🪆 MSW等のモック定義
│  └─...                    # その他フロント関連
├─.github
│  └─workflows
│      └─ci.yml             # 🤖 CI/CD用ワークフロー
├─docs
│  └─Test_Report.md         # � テスト報告書
├─.eslintrc.js              # ESLint設定
├─.prettierrc               # Prettier設定
├─.flake8                   # flake8設定
├─pyproject.toml            # black/pytest等Python設定
└─...                       # その他プロジェクトファイル
```